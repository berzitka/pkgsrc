$NetBSD: patch-ak,v 1.2 2010/12/26 20:59:31 markd Exp $

--- hald/freebsd/probing/probe-volume.c.orig	2009-09-17 13:45:09.000000000 +0000
+++ hald/freebsd/probing/probe-volume.c
@@ -33,7 +33,9 @@
 #include <fcntl.h>
 #include <unistd.h>
 #include <sys/ioctl.h>
+#ifndef __DragonFly__
 #include <sys/disk.h>
+#endif
 #include <sys/cdio.h>
 #include <sys/param.h>
 #include <sys/mount.h>
@@ -371,6 +373,7 @@ main (int argc, char **argv)
       is_blank = (! has_audio && ! has_data);
     }
 
+#ifndef __DragonFly__
   ioctl(fd, DIOCGMEDIASIZE, &media_size);
 
   /*
@@ -396,6 +399,7 @@ main (int argc, char **argv)
 	    }
 	}
     }
+#endif
 
   if (! has_children && ! is_swap && ! has_audio && ! has_data && ! is_blank)
     goto end;
@@ -628,10 +632,12 @@ main (int argc, char **argv)
 
   libhal_device_set_property_string(hfp_ctx, hfp_udi, "volume.uuid", vid ? vid->uuid : "", &hfp_error);
 
+#ifndef __DragonFly__
   ioctl(fd, DIOCGSECTORSIZE, &sector_size);
 
   if (sector_size != 0)
     libhal_device_set_property_uint64(hfp_ctx, hfp_udi, "volume.block_size", sector_size, &hfp_error);
+#endif
   if (media_size != 0)
     libhal_device_set_property_uint64(hfp_ctx, hfp_udi, "volume.size", media_size, &hfp_error);
   if (sector_size != 0 && media_size != 0)
