$NetBSD: patch-bd,v 1.1 2010/05/07 03:40:24 jnemeth Exp $

# reported upstream as https://issues.asterisk.org/view.php?id=17304

--- cdr/cdr_odbc.c.orig	2008-11-20 18:23:03.000000000 +0000
+++ cdr/cdr_odbc.c
@@ -220,9 +220,11 @@ static int odbc_load_module(int reload)
 		ast_verb(3, "cdr_odbc: dsn is %s\n", dsn);
 		ast_verb(3, "cdr_odbc: table is %s\n", table);
 
-		res = ast_cdr_register(name, ast_module_info->description, odbc_log);
-		if (res) {
-			ast_log(LOG_ERROR, "cdr_odbc: Unable to register ODBC CDR handling\n");
+		if (!reload) {
+			res = ast_cdr_register(name, ast_module_info->description, odbc_log);
+			if (res) {
+				ast_log(LOG_ERROR, "cdr_odbc: Unable to register ODBC CDR handling\n");
+			}
 		}
 	} while (0);
 
