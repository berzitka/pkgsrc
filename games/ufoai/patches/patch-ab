$NetBSD: patch-ab,v 1.2 2010/06/13 22:44:24 wiz Exp $

--- src/renderer/r_image.c.orig	2008-04-25 16:15:02.000000000 +0000
+++ src/renderer/r_image.c
@@ -254,7 +254,7 @@ static int R_LoadPNG (const char *name, 
 		png_set_palette_to_rgb(png_ptr);
 	/* convert 1-2-4 bits grayscale images to 8 bits grayscale */
 	if (color_type == PNG_COLOR_TYPE_GRAY && bit_depth < 8)
-		png_set_gray_1_2_4_to_8(png_ptr);
+		png_set_expand_gray_1_2_4_to_8(png_ptr);
 	if (png_get_valid(png_ptr, info_ptr, PNG_INFO_tRNS))
 		png_set_tRNS_to_alpha(png_ptr);
 
@@ -651,17 +651,6 @@ static void jpg_skip_input_data (j_decom
 	cinfo->src->bytes_in_buffer -= (size_t) num_bytes;
 }
 
-static void jpeg_mem_src (j_decompress_ptr cinfo, byte * mem, int len)
-{
-	cinfo->src = (struct jpeg_source_mgr *) (*cinfo->mem->alloc_small) ((j_common_ptr) cinfo, JPOOL_PERMANENT, sizeof(struct jpeg_source_mgr));
-	cinfo->src->init_source = jpg_null;
-	cinfo->src->fill_input_buffer = jpg_fill_input_buffer;
-	cinfo->src->skip_input_data = jpg_skip_input_data;
-	cinfo->src->resync_to_restart = jpeg_resync_to_restart;
-	cinfo->src->term_source = jpg_null;
-	cinfo->src->bytes_in_buffer = len;
-	cinfo->src->next_input_byte = mem;
-}
 
 /**
  * @sa R_LoadTGA
