$NetBSD: patch-af,v 1.5 2010/04/15 12:49:41 joerg Exp $

--- builtins/printf.def.orig	2009-11-20 20:31:23.000000000 +0000
+++ builtins/printf.def
@@ -85,6 +85,11 @@ $END
 #  undef PRIdMAX
 #endif
 
+#if defined (_AIX) && !defined (_AIX51)
+   /* AIX defines do not work.  Undefine them.  */
+#  undef PRIdMAX
+#  undef PRIuMAX
+#endif
 #if !defined (PRIdMAX)
 #  if HAVE_LONG_LONG
 #    define PRIdMAX	"lld"
@@ -92,6 +97,13 @@ $END
 #    define PRIdMAX	"ld"
 #  endif
 #endif
+#if !defined (PRIuMAX) && defined (_AIX)
+#  if HAVE_LONG_LONG
+#    define PRIuMAX "llu"
+#  else
+#    define PRIuMAX "lu"
+#  endif
+#endif
 
 #if !defined (errno)
 extern int errno;
@@ -172,7 +184,7 @@ extern int asprintf __P((char **, const 
 #endif
 
 #if !HAVE_VSNPRINTF
-extern int vsnprintf __P((char *, size_t, const char *, ...)) __attribute__((__format__ (printf, 3, 4)));
+extern int vsnprintf __P((char *, size_t, const char *, va_list)) __attribute__((__format__ (printf, 3, 0)));
 #endif
 
 static void printf_erange __P((char *));
@@ -487,7 +499,11 @@ printf_builtin (list)
 		p = pp = getintmax ();
 		if (p != pp)
 		  {
+#if defined (_AIX) && !defined (_AIX51)
+		    f = mklong (start, PRIdMAX, sizeof (intmax_t) - 2);
+#else
 		    f = mklong (start, PRIdMAX, sizeof (PRIdMAX) - 2);
+#endif
 		    PF (f, pp);
 		  }
 		else
@@ -514,7 +530,11 @@ printf_builtin (list)
 		p = pp = getuintmax ();
 		if (p != pp)
 		  {
+#if defined (_AIX) && !defined (_AIX51)
+		    f = mklong (start, PRIuMAX, sizeof (uintmax_t) - 2);
+#else
 		    f = mklong (start, PRIdMAX, sizeof (PRIdMAX) - 2);
+#endif
 		    PF (f, pp);
 		  }
 		else
