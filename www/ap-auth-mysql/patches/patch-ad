$NetBSD: patch-ad,v 1.4 2011/04/01 15:03:48 wiz Exp $

--- mod_auth_mysql.c.orig	2004-12-23 13:43:14.000000000 +0000
+++ mod_auth_mysql.c
@@ -55,12 +55,18 @@
 #include <ap_sha1.h>
 #endif
 
+#ifndef APR_XtOffsetOf
+#define APR_XtOffsetOf(x,y) APR_OFFSETOF(x,y)
+#endif
+
 #include <mysql.h>
 #include <errmsg.h>
 #include <mysqld_error.h>
 
 #ifdef HAVE_CRYPT_H
 #include <crypt.h>
+#else
+#include <unistd.h>
 #endif
 
 #ifndef TRUE
@@ -98,7 +104,7 @@ unsigned long auth_db_client_flag = 0;
 #define CRYPT_MD5_ENCRYPTION_FLAG	1<<3
 #endif
 #define PHP_MD5_ENCRYPTION_FLAG		1<<4
-#ifdef HAVE_CRYPT_H
+#if defined(HAVE_CRYPT_H) || defined(HAVE_LIBCRYPT)
 #define CRYPT_ENCRYPTION_FLAG		1<<5
 #endif
 #define SHA1SUM_ENCRYPTION_FLAG		1<<6
@@ -131,7 +137,7 @@ static int check_crypt_MD5_encryption(co
 }
 #endif
 
-#ifdef HAVE_CRYPT_H
+#if defined(HAVE_CRYPT_H) || defined(HAVE_LIBCRYPT)
 static int check_crypt_encryption(const char *passwd, char *enc_passwd)
 {
 	return (!strcmp(crypt(passwd, enc_passwd), enc_passwd));
@@ -250,7 +256,9 @@ encryption_type_entry supported_encrypti
 #if CRYPT_MD5
 	{ "Crypt_MD5",		check_crypt_MD5_encryption,		CRYPT_MD5_ENCRYPTION_FLAG },
 #endif
+#if defined(HAVE_CRYPT_H) || defined(HAVE_LIBCRYPT)
 	{ "Crypt",		check_crypt_encryption,			CRYPT_ENCRYPTION_FLAG },
+#endif
 	{ "PHP_MD5",		check_PHP_MD5_encryption,		PHP_MD5_ENCRYPTION_FLAG	},
 	{ "SHA1Sum",	check_SHA1Sum_encryption, SHA1SUM_ENCRYPTION_FLAG},
 	/* add additional encryption types below */
