$NetBSD: patch-aa,v 1.3 2010/12/05 23:22:00 wiz Exp $

Fix build with exiv2-0.21. From SVN.

--- libs/libkexiv2/libkexiv2/kexiv2exif.cpp.orig	2010-12-05 23:06:51.000000000 +0000
+++ libs/libkexiv2/libkexiv2/kexiv2exif.cpp
@@ -295,7 +295,11 @@ QString KExiv2::getExifTagTitle(const ch
     {
         std::string exifkey(exifTagName);
         Exiv2::ExifKey ek(exifkey);
+#if (EXIV2_TEST_VERSION(0,21,0))
+        return QString::fromLocal8Bit( ek.tagLabel().c_str() );
+#else
         return QString::fromLocal8Bit( Exiv2::ExifTags::tagTitle(ek.tag(), ek.ifdId()) );
+#endif
     }
     catch (Exiv2::Error& e)
     {
@@ -311,7 +315,11 @@ QString KExiv2::getExifTagDescription(co
     {
         std::string exifkey(exifTagName);
         Exiv2::ExifKey ek(exifkey);
+#if (EXIV2_TEST_VERSION(0,21,0))
+        return QString::fromLocal8Bit( ek.tagDesc().c_str() );
+#else
         return QString::fromLocal8Bit( Exiv2::ExifTags::tagDesc(ek.tag(), ek.ifdId()) );
+#endif
     }
     catch (Exiv2::Error& e)
     {
@@ -950,12 +958,45 @@ KExiv2::TagsMap KExiv2::getStdExifTagsLi
     try
     {
         QList<const Exiv2::TagInfo*> tags;
+        TagsMap                      tagsMap;
+
+#if (EXIV2_TEST_VERSION(0,21,0))
+        const Exiv2::GroupInfo* gi = Exiv2::ExifTags::groupList();
+        while (gi->tagList_ != 0)
+        {
+            if (QString(gi->ifdName_) != QString("Makernote"))
+            {
+                Exiv2::TagListFct tl     = gi->tagList_;
+                const Exiv2::TagInfo* ti = tl();
+
+                while (ti->tag_ != 0xFFFF)
+                {
+                    tags << ti;
+                    ++ti;
+                }
+            }
+            ++gi;
+        }
+
+        for (QList<const Exiv2::TagInfo*>::iterator it = tags.begin(); it != tags.end(); ++it)
+        {
+            do
+            {
+                const Exiv2::TagInfo* ti = *it;
+                QString key              = QLatin1String( Exiv2::ExifKey(*ti).key().c_str() );
+                QStringList values;
+                values << ti->name_ << ti->title_ << ti->desc_;
+                tagsMap.insert(key, values);
+                ++(*it);
+            }
+            while((*it)->tag_ != 0xffff);
+        }
+#else
         tags << Exiv2::ExifTags::ifdTagList()
              << Exiv2::ExifTags::exifTagList()
              << Exiv2::ExifTags::iopTagList()
              << Exiv2::ExifTags::gpsTagList();
 
-        TagsMap tagsMap;
         for (QList<const Exiv2::TagInfo*>::iterator it = tags.begin(); it != tags.end(); ++it)
         {
             do
@@ -968,6 +1009,7 @@ KExiv2::TagsMap KExiv2::getStdExifTagsLi
             }
             while((*it)->tag_ != 0xffff);
         }
+#endif
         return tagsMap;
     }
     catch( Exiv2::Error& e )
@@ -983,14 +1025,15 @@ KExiv2::TagsMap KExiv2::getMakernoteTags
     try
     {
         QList<const Exiv2::TagInfo*> tags;
+        TagsMap                      tagsMap;
 
 #if (EXIV2_TEST_VERSION(0,21,0))
 
         const Exiv2::GroupInfo* gi = Exiv2::ExifTags::groupList();
 
-        while (gi->ifdId_ != Exiv2::lastIfdId)
+        while (gi->tagList_ != 0)
         {
-            if (QString(gi->name_) == QString("Makernote"))
+            if (QString(gi->ifdName_) == QString("Makernote"))
             {
                 Exiv2::TagListFct tl     = gi->tagList_;
                 const Exiv2::TagInfo* ti = tl();
@@ -1004,6 +1047,20 @@ KExiv2::TagsMap KExiv2::getMakernoteTags
             ++gi;
         }
 
+        for (QList<const Exiv2::TagInfo*>::iterator it = tags.begin(); it != tags.end(); ++it)
+        {
+            do
+            {
+                const Exiv2::TagInfo* ti = *it;
+                QString key              = QLatin1String( Exiv2::ExifKey(*ti).key().c_str() );
+                QStringList values;
+                values << ti->name_ << ti->title_ << ti->desc_;
+                tagsMap.insert(key, values);
+                ++(*it);
+            }
+            while((*it)->tag_ != 0xffff);
+        }
+
 #else
 
 #if (EXIV2_TEST_VERSION(0,18,1))
@@ -1056,9 +1113,6 @@ KExiv2::TagsMap KExiv2::getMakernoteTags
 
 #endif // (EXIV2_TEST_VERSION(0,18,1))
 
-#endif // (EXIV2_TEST_VERSION(0,21,0))
-
-        TagsMap tagsMap;
         for (QList<const Exiv2::TagInfo*>::iterator it = tags.begin(); it != tags.end(); ++it)
         {
             do
@@ -1071,6 +1125,9 @@ KExiv2::TagsMap KExiv2::getMakernoteTags
             }
             while((*it)->tag_ != 0xffff);
         }
+
+#endif // (EXIV2_TEST_VERSION(0,21,0))
+
         return tagsMap;
     }
     catch( Exiv2::Error& e )
