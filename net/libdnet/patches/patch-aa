--- configure.in.orig	2011-02-06 14:20:17.000000000 +0100
+++ configure.in	2011-02-06 14:20:51.000000000 +0100
@@ -186,6 +186,9 @@
 if test "$ac_cv_header_sys_socket_h" = yes ; then
 	AC_DNET_SOCKADDR_SA_LEN
 fi
+if test "$ac_cv_header_net_if_h" = yes ; then
+	AC_DNET_IFREQ_IFR_SPACE
+fi
 if test "$ac_cv_header_net_if_arp_h" = yes ; then
 	AC_DNET_ARPREQ_ARP_DEV
 fi
--- aclocal.m4.orig	2011-02-06 14:02:01.000000000 +0100
+++ aclocal.m4	2011-02-06 14:08:47.000000000 +0100
@@ -6776,6 +6776,30 @@
     fi])
 
 dnl
+dnl Check for NetBSD ifreq structure
+dnl
+dnl usage:	AC_DNET_IFREQ_IFR_SPACE
+dnl results:	HAVE_IFREQ_IFR_SPACE (defined)
+dnl
+AC_DEFUN(AC_DNET_IFREQ_IFR_SPACE,
+    [AC_MSG_CHECKING(for ifr_space in ifreq struct)
+    AC_CACHE_VAL(ac_cv_dnet_ifreq_has_ifr_space,
+        AC_TRY_COMPILE([
+# ifndef _IFREQ_IFR_SPACE
+#	define _IFREQ_IFR_SPACE 1 
+# endif
+#       include <sys/types.h>
+#       include <net/if.h>],
+        [u_int i = sizeof(((struct ifreq *)0)->ifr_space)],
+        ac_cv_dnet_ifreq_has_ifr_space=yes,
+        ac_cv_dnet_ifreq_has_ifr_space=no))
+    AC_MSG_RESULT($ac_cv_dnet_ifreq_has_ifr_space)
+    if test $ac_cv_dnet_ifreq_has_ifr_space = yes ; then
+            AC_DEFINE(HAVE_IFREQ_IFR_SPACE, 1,
+                      [Define if ifreq struct has ifr_space.])
+    fi])
+
+dnl
 dnl Check for sockaddr_in6 struct in <netinet/in.h>
 dnl
 dnl usage:	AC_DNET_SOCKADDR_IN6
--- include/config.h.in.orig	2011-02-06 14:54:20.000000000 +0100
+++ include/config.h.in	2011-02-06 14:55:18.000000000 +0100
@@ -142,6 +142,9 @@
 /* Define if sockaddr struct has sa_len. */
 #undef HAVE_SOCKADDR_SA_LEN
 
+/* Define if ifreq struct has ifr_space. */
+#undef HAVE_IFREQ_IFR_SPACE
+
 /* Define to 1 if you have the <stdint.h> header file. */
 #undef HAVE_STDINT_H

--- src/intf.c.orig	2011-02-06 14:08:54.000000000 +0100
+++ src/intf.c	2011-02-06 14:09:57.000000000 +0100
@@ -55,6 +55,9 @@
 # define ifr_mtu	ifr_metric
 #endif
 
+#ifdef HAVE_IFREQ_IFR_SPACE
+# define NEXTIFR(i)	(i + 1)
+#else
 #ifdef HAVE_SOCKADDR_SA_LEN
 # define NEXTIFR(i)	((struct ifreq *)((u_char *)&i->ifr_addr + \
 				(i->ifr_addr.sa_len ? i->ifr_addr.sa_len : \
@@ -62,6 +65,7 @@
 #else
 # define NEXTIFR(i)	(i + 1)
 #endif
+#endif
 
 /* XXX - superset of ifreq, for portable SIOC{A,D}IFADDR */
 struct dnet_ifaliasreq {
